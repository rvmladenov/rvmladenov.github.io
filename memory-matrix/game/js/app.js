"use strict";function getLvl(){return currentLvl}function createBackground(){mainContainer=document.createElement("main");mainContainer.id="main-container";document.body.appendChild(mainContainer)}function createScoreBoard(){var e=document.createElement("div");e.id="score-board";mainContainer.appendChild(e);var t=document.createElement("ul");e.appendChild(t);var n=[new ScoreBoardElement("Tiles",getLvl()),new ScoreBoardElement("Trials",trials),new ScoreBoardElement("Score",score)];var r=n.length;for(var i=0;i<r;i++){var s=document.createElement("li");s.className="score-board-element";s.innerText=n[i].content;s.textContent=n[i].content;t.appendChild(s);var o=document.createElement("span");o.className="score-board-value";o.id=n[i].content;o.innerText=n[i].val;o.textContent=n[i].val;s.appendChild(o)}}function addPoints(e,t){function r(){var e=document.getElementById("Score");e.classList.add("blinkingScore");setTimeout(function(){$("#Score").removeClass("blinkingScore")},500)}t=t||0;var n=document.getElementById("Score");score=n.innerText||n.textContent;score=parseInt(score)+parseInt(e)+parseInt(t);n.innerText=score;n.textContent=score;r()}function updateLevelBonus(e){switch(e){case"down":if(levelBonus>5){levelBonus/=2}break;case"up":levelBonus*=2;break}}function getUserClick(e){if(playerCanClick===true){var t=e.target;var n=t.getAttribute("data-is-clicked")?true:false;if(t.getAttribute("data-is-true")&&!n){var r=getLvl();if(tilesCounter<r){t.setAttribute("data-is-clicked","true");tilesCounter++;addPoints(pointsForCorrectAnswer);updateInfobox(MESSAGES.tileSucess);t.setAttribute("data-is-true","false")}else if(tilesCounter===r){t.setAttribute("data-is-clicked","true");wasLevelCleared=true;updateLevelBonus("up");addPoints(pointsForCorrectAnswer,levelBonus);t.setAttribute("data-is-true","false");setTimeout(function(){updateInfobox(MESSAGES.levelSuccess);prepAndShowInfoForNextLvl()},infoBoxTimeout)}}else if(n){}else{t.classList.add("incorrectAnswer");updateLevelBonus("down");playerCanClick=false;wasLevelCleared=false;updateInfobox(MESSAGES.levelLost);prepAndShowInfoForNextLvl()}}}function goToNextLvl(){playerCanClick=true;if(trials){trials--;document.getElementById("Trials").innerHTML=trials.toString();document.getElementById("Tiles").innerHTML=getLvl();tilesCounter=1;var e=getLvl();var t=e<=boardDimArray.length?e-1:boardDimArray.length-1;createBoard(boardDimArray[t][0],boardDimArray[t][1]);updateInfobox(MESSAGES.payAttention)}else{endGame()}}function updatePopupSize(e,t){if(popup){e=e||board.offsetWidth;t=t||board.offsetHeight;popup.style.width=e+"px";popup.style.height=t+"px";popup.style.left=-(e/2)+"px"}}function updateBoardAndPopupSizes(e,t){var n=e*cellSize+boardPadding;var r=t*cellSize+boardPadding;$("#board").animate({width:n,height:r},100);updatePopupSize(n,r)}function createBoard(e,t){if(e){e=e&&e>minCellsSize?e<maxCellsSize?e:maxCellsSize:minCellsSize}else{e=initCellsSize}if(t){t=t&&t>minRowsSize?t<maxRowsSize?t:maxRowsSize:minRowsSize}else{t=initRowsSize}if(!board){board=document.createElement("div");board.id="board";boardContainer.innerHTML="";boardContainer.appendChild(board)}board.innerHTML="";updateBoardAndPopupSizes(e,t);setTimeout(function(){for(var n=1;n<=t;n++){var r=document.createElement("div");r.setAttribute("id","row"+n);r.className="row";for(var i=1;i<=e;i++){var s=document.createElement("div");s.setAttribute("id","cell"+n+i);s.className="cell";r.appendChild(s)}board.appendChild(r)}assignCorrectAnswers()},correctAnswerTimeout)}function createInfoBox(){var e=document.createElement("div");e.id="infobox";mainContainer.appendChild(e)}function updateInfobox(e){var t=document.getElementById("infobox");t.innerText=e;t.textContent=e}function assignCorrectAnswers(){var e=getLvl();var t=[],n=[],r=document.getElementsByClassName("cell"),i=true;var s=function(){return Math.floor(Math.random()*r.length)};for(var o=0;o<e;o++){i=true;while(i){var u=s();if(t.indexOf(u)===-1){var a=r[u];n.push(a);a.setAttribute("data-is-true","true");t.push(u);i=false}}}for(var f=0;f<n.length;f++){n[f].classList.add("openAnswer")}setTimeout(function(){hidePattern(n)},beforeHideCellsTimeout)}function hidePattern(e){for(var t=0;t<e.length;t++){e[t].classList.remove("openAnswer")}for(var n=0;n<document.getElementsByClassName("cell").length;n++){document.getElementsByClassName("cell")[n].addEventListener("click",getUserClick.bind(this),false)}updateInfobox(MESSAGES.guess)}function closePopup(){popup.classList.remove("opened");goToNextLvl()}function updateCurrentLvl(){if(wasLevelCleared===true){currentLvl++}else if(currentLvl>1){currentLvl--}}function prepAndShowInfoForNextLvl(){var e=document.getElementById("infoDialogTxt");if(!popup){popup=document.createElement("div");e=document.createElement("p");e.id="infoDialogTxt";popup.setAttribute("id","popup");if(canClickOnInfoBox===true){popup.addEventListener("click",closePopup,false)}boardContainer.appendChild(popup);popup.appendChild(e)}updateCurrentLvl();var t="";if(wasLevelCleared){t+='Bonus Points: <span class="green">+'+levelBonus+"</span><br />"}t+='Next: <span class="red">'+getLvl()+"</span> tiles";e.innerHTML=t;popup.classList.add("opened");updatePopupSize();if(canClickOnInfoBox!==true){setTimeout(function(){closePopup()},betweenLevelsTimeout)}}function storeMaxScore(e){if(typeof storage!=="undefined"){if(typeof storage.maxScore!=="undefined"){if(parseInt(storage.maxScore)<e){storage.setItem("maxScore",e);return true}}else{storage.setItem("maxScore",e);return true}}return false}function endGame(){if(!storeMaxScore(score)){$("#boardCont").html("").append("<div class='gameOver'><h2>"+MESSAGES.gameOver+"</h2>\n<p>"+MESSAGES.scoreMessage+score+'</p>\n<a href="javascript:window.location = window.location;">'+MESSAGES.newGame+"</a></div>")}else{$("#boardCont").html("").append("<div class='gameOver'><h2>"+MESSAGES.gameOver+"</h2>\n<p>"+MESSAGES.scoreMessage+score+"</p>\n"+MESSAGES.bestResult+'</br><a href="javascript:window.location = window.location;">'+MESSAGES.newGame+"</a></div>")}}function startGame(){if(!boardContainer){boardContainer=document.createElement("div");boardContainer.id="boardCont";mainContainer.appendChild(boardContainer)}$("#boardCont").html("").append("<div class='gameOver'><h2>"+MESSAGES.startGame+'</h2>\n<h4>by Desert Planet</h4><a href="javascript:;" onclick="createBoard()">'+MESSAGES.startGameMsg+"</a></div>")}function initGame(){createBackground();createScoreBoard();startGame();createInfoBox()}var mainContainer,boardContainer,board,currentLvl=3,tilesCounter=1,levelBonus=5,cellSize=50,pointsForCorrectAnswer=10,wasLevelCleared=true,playerCanClick=true,minRowsSize=2,minCellsSize=2,initCellsSize=3,initRowsSize=3,maxRowsSize=6,maxCellsSize=6,boardPadding=60,trials=15,score=0,beforeHideCellsTimeout=1500,correctAnswerTimeout=500,infoBoxTimeout=300,betweenLevelsTimeout=2e3,popup=null,canClickOnInfoBox=true,storage=window.localStorage;var boardDimArray=[[2,2],[2,2],[3,3],[4,3],[4,4],[5,4],[5,5],[6,5],[6,6]];var MESSAGES={levelLost:"Sorry, you missed!\nTry again with less tiles!",tileSucess:"You hit it right! Guess the next tile!",levelSuccess:"Congratulations! You won another level.\nTry with more tiles!",guess:"Guess the next tile!",gameOver:"GAME OVER!",scoreMessage:"Your score is: ",payAttention:"Remember the tiles positions!",bestResult:"Your result will be stored as BEST RESULT.\nCongratulations!",newGame:"New game",startGameMsg:"Start Game",startGame:"Memory Matrix",teamName:"by Desert Planet"};var ScoreBoardElement=function(e,t){this.content=e;this.val=t};$(document).ready(function(){initGame()})